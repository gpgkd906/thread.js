<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Threads.js by gpgkd906</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Threads.js</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/gpgkd906/threads.js" class="btn">View on GitHub</a>
      <a href="https://github.com/gpgkd906/threads.js/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/gpgkd906/threads.js/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="threadjs" class="anchor" href="#threadjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>thread.js</h1>

<h2>
<a id="what-is-threadjs" class="anchor" href="#what-is-threadjs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is thread.js</h2>

<p>threads is a lightweight thread api with es6 syntax.<br>
and when you with the latest Chrome/Firefox/Edge, it use WebWorker to <strong>free boost</strong> your application with extra processor.<br>
(safari do not support let/const syntax yet so it throw errors, but you can rewrite it to use var syntax--just a little work, if you want.)</p>

<h2>
<a id="how-to-use-it" class="anchor" href="#how-to-use-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to use it</h2>

<p>you could not to be confusion.<br>
there is only one api: <strong>Thread.spawn</strong><br>
Thread.spawn receives only one parameter, an object like  </p>

<pre><code>{
    data: data,
    move: [tansferable],
    fn: function (data) {},
}
</code></pre>

<p>and returns a <strong>Promise</strong> object.</p>

<h3>
<a id="notice" class="anchor" href="#notice" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Notice</h3>

<p>which <strong>fn</strong> you give will be run in an <strong>Standalone environment</strong>, so you can not refer to your main context inside the fn.</p>

<h3>
<a id="with-chromefirefox" class="anchor" href="#with-chromefirefox" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>with chrome/firefox</h3>

<div class="highlight highlight-text-html-basic"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>lib/Thread.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">Thread</span>.<span class="pl-en">spawn</span>({
    data<span class="pl-k">:</span> data,
    <span class="pl-en">fn</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
         <span class="pl-s"><span class="pl-pds">"</span>use strict<span class="pl-pds">"</span></span>;
         <span class="pl-k">let</span> result <span class="pl-k">=</span> data;
        <span class="pl-k">return</span> result;
    }
}).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">result</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
});</pre></div>

<h3>
<a id="with-nodejs" class="anchor" href="#with-nodejs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>with nodejs</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> Thread <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>threads.js<span class="pl-pds">"</span></span>).<span class="pl-smi">Thread</span>;

<span class="pl-smi">Thread</span>.<span class="pl-en">spawn</span>({
    data<span class="pl-k">:</span> data,
    <span class="pl-en">fn</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-s"><span class="pl-pds">"</span>use strict<span class="pl-pds">"</span></span>;
        <span class="pl-k">let</span> result <span class="pl-k">=</span> data;
        <span class="pl-k">return</span> result;
    }
}).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">result</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(result);
});</pre></div>

<p>run example from node</p>

<pre><code>$ node --harmony_destructuring example.js
</code></pre>

<h3>
<a id="get-it-faster-with-browser" class="anchor" href="#get-it-faster-with-browser" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get it faster with browser</h3>

<p>use move option to transfer big data without copy-cost.<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Transferable">Transferable</a></p>

<div class="highlight highlight-source-js"><pre><span class="pl-s"><span class="pl-pds">"</span>use strict<span class="pl-pds">"</span></span>;
<span class="pl-k">let</span> count <span class="pl-k">=</span> <span class="pl-c1">10</span>;
<span class="pl-k">let</span> startTime <span class="pl-k">=</span> <span class="pl-c1">Date</span>.<span class="pl-en">now</span>();
<span class="pl-k">for</span>(<span class="pl-k">let</span> i <span class="pl-k">=</span> <span class="pl-c1">0</span>; i <span class="pl-k">&lt;</span> count; i<span class="pl-k">++</span>) {
    <span class="pl-k">let</span> data <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Uint8Array</span>(<span class="pl-c1">10</span><span class="pl-k">*</span><span class="pl-c1">1024</span><span class="pl-k">*</span><span class="pl-c1">1024</span>);
    <span class="pl-smi">Thread</span>.<span class="pl-en">spawn</span>({
        data<span class="pl-k">:</span> data,
        move<span class="pl-k">:</span> [<span class="pl-smi">data</span>.<span class="pl-smi">buffer</span>],
        <span class="pl-en">fn</span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>, <span class="pl-smi">move</span>) {
            <span class="pl-s"><span class="pl-pds">"</span>use strict<span class="pl-pds">"</span></span>;
            <span class="pl-k">for</span>(<span class="pl-k">let</span> i <span class="pl-k">in</span> data) {
                <span class="pl-c">//do something</span>
            }
            <span class="pl-en">move</span>(<span class="pl-smi">data</span>.<span class="pl-smi">buffer</span>);
            <span class="pl-k">let</span> result <span class="pl-k">=</span> data;
            <span class="pl-k">return</span> result;
        }
    }).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">result</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>((<span class="pl-c1">Date</span>.<span class="pl-en">now</span>() <span class="pl-k">-</span> startTime) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> ms<span class="pl-pds">"</span></span>);
    }).<span class="pl-en">catch</span>(<span class="pl-smi">error</span> <span class="pl-k">=&gt;</span> {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
    });
}</pre></div>

<h1>
<a id="what-is-next" class="anchor" href="#what-is-next" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What is next?</h1>

<p>I will replace prototype to Class when Chrome/Firefox/Safari/Edge is ready.<br>
and other es6(or es7?) syntax when at least 2 browser support it.</p>

<h1>
<a id="issue" class="anchor" href="#issue" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Issue</h1>

<p>Anything will be receive, please tell me.</p>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h1>

<p>Licensed under the <a href="https://opensource.org/licenses/MIT">MIT License</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/gpgkd906/threads.js">Threads.js</a> is maintained by <a href="https://github.com/gpgkd906">gpgkd906</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
